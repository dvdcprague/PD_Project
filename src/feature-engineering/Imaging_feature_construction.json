{"paragraphs":[{"title":"Imaging_feature_construction","text":"%md\n#### This file described how to construct the features for imaging data, including MRI and DATscan. \n#### Run the blocks one by one, rename and save the intermediate files in certain directories and change the source file directory if necessary. The ","user":"anonymous","dateUpdated":"2017-12-10T10:45:56-0800","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"markdown","editOnDblClick":true},"editorMode":"ace/mode/markdown","title":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1512931349941_1123709456","id":"20171210-104229_1049919644","dateCreated":"2017-12-10T10:42:29-0800","status":"READY","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:5500"},{"text":"// any import statements go here\n\nimport org.apache.commons.io.IOUtils\nimport java.net.URL\nimport java.nio.charset.Charset","user":"anonymous","dateUpdated":"2017-12-10T08:12:42-0800","config":{"colWidth":12,"results":[{"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}}}],"enabled":true,"editorSetting":{"language":"scala"},"editorMode":"ace/mode/scala","tableHide":false},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1509329774806_765847949","id":"20161018-061641_596592926","dateCreated":"2017-10-29T19:16:14-0700","dateStarted":"2017-12-10T08:08:35-0800","dateFinished":"2017-12-10T08:08:35-0800","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:5501"},{"text":"%md\n#### Load Magnetic_Resonance_Imaging.csv, DATScan_raw.csv, enrolled_patients.csv\nMRI: PATNO, MRIRSLT\nDATscan: PATNO, Caudate, Putamen, Striatum, Density, Asymmetry. All these features are calculated according to the equations described in Derived_Variable_Definitions_and_Score_Calculations.csv, and saved as file datscan_raw.csv\nenrolled_patients: patient_no, age, gender, diagnosis. This file was obtained from another team member, the construction guide is saved in section 4.1 in Team27 Project - Software Implementation and Document","user":"anonymous","dateUpdated":"2017-12-10T10:41:11-0800","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"markdown","editOnDblClick":true},"editorMode":"ace/mode/markdown","editorHide":true,"tableHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<div class=\"markdown-body\">\n<h4>Load Magnetic_Resonance_Imaging.csv, DATScan_raw.csv, enrolled_patients.csv</h4>\n<p>MRI: PATNO, MRIRSLT<br/>DATscan: PATNO, Caudate, Putamen, Striatum, Density, Asymmetry. All these features are calculated according to the equations described in Derived_Variable_Definitions_and_Score_Calculations.csv, and saved as file datscan_raw.csv<br/>enrolled_patients: patient_no, age, gender, diagnosis. This file was obtained from another team member, the construction guide is saved in section 4.1 in Team27 Project - Software Implementation and Document</p>\n</div>"}]},"apps":[],"jobName":"paragraph_1512922671066_936974974","id":"20171210-081751_1623631770","dateCreated":"2017-12-10T08:17:51-0800","dateStarted":"2017-12-10T10:41:11-0800","dateFinished":"2017-12-10T10:41:11-0800","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:5502"},{"title":"","text":"// Define case class\ncase class Patient(patient_no: String, age: Int, gender: String, diagnosis: String)\ncase class MRI_result(PATNO: String, MRIRSLT: String)\ncase class Datscan(PATNO: String, Caudate:Double, Putamen:Double, Striatum: Double, Density:Double, Asymmetry:Double)\n// load raw data\n\nval enrolled_patients = sc.textFile(\"/bhd-project-team27/data/enrolled_patients.csv\")\n    .map(line => line.split(\",\"))\n    .filter(line => !line(0).contains(\"record_id\"))\n    .map(line => Patient(line(1), line(3).toInt, line(4), line(2)))\n\n        \nval MRI = sc.textFile(\"/bhd-project-team27/data/Magnetic_Resonance_Imaging.csv\")\n    .map(line => line.split(\",\"))\n    .filter(line => !line(0).contains(\"REC_ID\"))\n    .map(line => MRI_result(line(2), line(11)))\n    \n\nval raw_scan = sc.textFile(\"/bhd-project-team27/data/datscan_raw.csv\")\n    .map(line => line.split(\",\"))\n    .filter(line => !line(0).contains(\"patient_no\"))\n    .map(line => Datscan(line(0), line(1).toDouble, line(2).toDouble, line(3).toDouble, line(4).toDouble, line(5).toDouble))\n\n    \n\n//construct dataframe\n\n// Register the DataFrames as temp table to use SQL queries\nenrolled_patients.toDF(\"patient_no\", \"age\", \"gender\", \"diagnosis\").registerTempTable(\"enrolled_patients\")\nMRI.toDF(\"PATNO\", \"MRIRSLT\").registerTempTable(\"MRI\")\nraw_scan.toDF(\"patient_no\", \"Caudate\", \"Putamen\", \"Striatum\", \"Density\", \"Asymmetry\").registerTempTable(\"raw_scan\")\n\n//MRI.take(10).foreach(println)","user":"anonymous","dateUpdated":"2017-12-10T10:46:59-0800","config":{"colWidth":12,"results":[{"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}}}],"enabled":true,"editorSetting":{"language":"scala","editOnDblClick":true},"editorMode":"ace/mode/scala","tableHide":true,"title":false,"editorHide":false},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1509329774807_765463200","id":"20161018-061641_1949699663","dateCreated":"2017-10-29T19:16:14-0700","dateStarted":"2017-12-10T10:39:27-0800","dateFinished":"2017-12-10T10:39:28-0800","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:5503"},{"text":"%md\n#### MRI\nJoin MRI and enrolled patients, save the file as MRI_joined.csv, store in the same directory of this json file, load the file for next step","user":"anonymous","dateUpdated":"2017-12-10T10:41:14-0800","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"markdown","editOnDblClick":true},"editorMode":"ace/mode/markdown","editorHide":true,"tableHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<div class=\"markdown-body\">\n<h4>MRI</h4>\n<p>Join MRI and enrolled patients, save the file as MRI_joined.csv, store in the same directory of this json file, load the file for next step</p>\n</div>"}]},"apps":[],"jobName":"paragraph_1512923412440_-1405731552","id":"20171210-083012_860478587","dateCreated":"2017-12-10T08:30:12-0800","dateStarted":"2017-12-10T10:41:14-0800","dateFinished":"2017-12-10T10:41:14-0800","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:5504"},{"text":"%sql\nselect patient_no, age, gender, MRIRSLT, diagnosis from enrolled_patients p left join MRI m on patient_no=PATNO   where MRIRSLT =1 or MRIRSLT=2 or MRIRSLT=3 order by patient_no \n\n--select * from MRI Limit 10\n--select * from enrolled_patients","user":"anonymous","dateUpdated":"2017-12-10T08:38:15-0800","config":{"colWidth":12,"graph":{"mode":"multiBarChart","height":300,"optionOpen":true,"keys":[{"name":"patientId","index":0,"aggr":"sum"}],"values":[{"name":"value","index":1,"aggr":"sum"}],"groups":[],"scatter":{}},"enabled":true,"results":{"0":{"graph":{"mode":"multiBarChart","height":300,"optionOpen":true,"setting":{"multiBarChart":{}},"commonSetting":{},"keys":[{"name":"patient_no","index":0,"aggr":"sum"}],"groups":[{"name":"patient_no","index":0,"aggr":"sum"}],"values":[{"name":"MRIRSLT","index":3,"aggr":"sum"}]},"helium":{}}},"editorSetting":{"language":"sql"},"editorMode":"ace/mode/sql","tableHide":false},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1509329774807_765463200","id":"20161018-061641_1706459139","dateCreated":"2017-10-29T19:16:14-0700","dateStarted":"2017-12-10T08:32:34-0800","dateFinished":"2017-12-10T08:33:03-0800","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:5505"},{"text":"case class merged_MRI(patient_no: String,  MRIRSLT: Int)\nval new_MRI = sc.textFile(\"/bhd-project-team27/data/MRI_joined.csv\")\n    .map(line => line.split(\",\"))\n    .filter(line => !line(0).contains(\"patient_no\"))\n    .map(line => merged_MRI(line(0), line(1).toInt))\nnew_MRI.toDF(\"PATNO\", \"MRIRSLT\").registerTempTable(\"new_MRI\")","user":"anonymous","dateUpdated":"2017-12-10T10:47:03-0800","config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false},"editorMode":"ace/mode/scala","tableHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"defined class merged_MRI\nnew_MRI: org.apache.spark.rdd.RDD[merged_MRI] = MapPartitionsRDD[3250] at map at <console>:44\nwarning: there was one deprecation warning; re-run with -deprecation for details\n"}]},"apps":[],"jobName":"paragraph_1509329774810_764308953","id":"20161018-061641_182015159","dateCreated":"2017-10-29T19:16:14-0700","dateStarted":"2017-12-10T09:03:29-0800","dateFinished":"2017-12-10T09:03:29-0800","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:5506"},{"text":"%md\nAs patients has different number of MRI test, average the number as their value, save the file as MRI_processed.csv and load this file for next step","user":"anonymous","dateUpdated":"2017-12-10T10:41:19-0800","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"markdown","editOnDblClick":true},"editorMode":"ace/mode/markdown","editorHide":true,"tableHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<div class=\"markdown-body\">\n<p>As patients has different number of MRI test, average the number as their value, save the file as MRI_processed.csv and load this file for next step</p>\n</div>"}]},"apps":[],"jobName":"paragraph_1512923673164_1052412202","id":"20171210-083433_1612285864","dateCreated":"2017-12-10T08:34:33-0800","dateStarted":"2017-12-10T10:41:19-0800","dateFinished":"2017-12-10T10:41:19-0800","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:5507"},{"text":"%sql\nselect PATNO, avg(MRIRSLT) as MRIRSLT from new_MRI group by PATNO order by PATNO","user":"anonymous","dateUpdated":"2017-12-10T09:03:32-0800","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"sql"},"editorMode":"ace/mode/sql","tableHide":false},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1510020015987_140442273","id":"20171106-180015_1988488516","dateCreated":"2017-11-06T18:00:15-0800","dateStarted":"2017-12-10T09:03:32-0800","dateFinished":"2017-12-10T09:03:33-0800","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:5508"},{"text":"case class new_merged_MRI(patient_no: String,  MRIRSLT: Double)\nval incomplete_MRI = sc.textFile(\"/bhd-project-team27/data/MRI_processed.csv\")\n    .map(line => line.split(\",\"))\n    .filter(line => !line(0).contains(\"PATNO\"))\n    .map(line => new_merged_MRI(line(0), line(1).toDouble))\nincomplete_MRI.toDF(\"PATNO\", \"MRIRSLT\").registerTempTable(\"incomplete_MRI\")\n","user":"anonymous","dateUpdated":"2017-12-10T10:47:09-0800","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1512930893577_970921459","id":"20171210-103453_1785405032","dateCreated":"2017-12-10T10:34:53-0800","status":"READY","progressUpdateIntervalMs":500,"$$hashKey":"object:5509"},{"text":"%md\n#### DATscan\nSame as MRI, average the number of each feature for every individual patient, as the value for the patient, then save the file as scan_2.csv, load this file for next step","user":"anonymous","dateUpdated":"2017-12-10T10:41:24-0800","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"markdown","editOnDblClick":true},"editorMode":"ace/mode/markdown","editorHide":true,"tableHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<div class=\"markdown-body\">\n<h4>DATscan</h4>\n<p>Same as MRI, average the number of each feature for every individual patient, as the value for the patient, then save the file as scan_2.csv, load this file for next step</p>\n</div>"}]},"apps":[],"jobName":"paragraph_1512925582932_-242573806","id":"20171210-090622_872448403","dateCreated":"2017-12-10T09:06:22-0800","dateStarted":"2017-12-10T10:41:24-0800","dateFinished":"2017-12-10T10:41:24-0800","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:5510"},{"text":"%sql\nselect patient_no, avg(Caudate) as Caudate, avg(Putamen) as Putamen, avg(Striatum) as Striatum, avg(Density) as Density, avg(Asymmetry) as Asymmetry from raw_scan group by patient_no order by patient_no","user":"anonymous","dateUpdated":"2017-12-10T09:12:07-0800","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"sql"},"editorMode":"ace/mode/sql","tableHide":false},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1510024103969_1582551717","id":"20171106-190823_993027177","dateCreated":"2017-11-06T19:08:23-0800","dateStarted":"2017-12-10T09:12:07-0800","dateFinished":"2017-12-10T09:12:07-0800","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:5511"},{"text":"val scan_2 = sc.textFile(\"/bhd-project-team27/data/scan_2.csv\")\n    .map(line => line.split(\",\"))\n    .filter(line => !line(0).contains(\"patient_no\"))\n    .map(line => Datscan(line(0), line(1).toDouble, line(2).toDouble, line(3).toDouble, line(4).toDouble, line(5).toDouble))\nscan_2.toDF(\"PATNO\", \"Caudate\", \"Putamen\", \"Striatum\", \"Density\", \"Asymmetry\").registerTempTable(\"scan_2\")\n","user":"anonymous","dateUpdated":"2017-12-10T10:47:15-0800","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala"},"editorMode":"ace/mode/scala","tableHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"scan_2: org.apache.spark.rdd.RDD[Datscan] = MapPartitionsRDD[3287] at map at <console>:44\nwarning: there was one deprecation warning; re-run with -deprecation for details\n"}]},"apps":[],"jobName":"paragraph_1510024251343_1655836254","id":"20171106-191051_876381625","dateCreated":"2017-11-06T19:10:51-0800","dateStarted":"2017-12-10T09:09:44-0800","dateFinished":"2017-12-10T09:09:44-0800","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:5512"},{"text":"%md\nJoin the scan data with enrolled patients, save the file as scan_3, replace the the null value using mean, and load this file for next step","user":"anonymous","dateUpdated":"2017-12-10T10:41:29-0800","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"markdown","editOnDblClick":true},"editorMode":"ace/mode/markdown","editorHide":true,"tableHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<div class=\"markdown-body\">\n<p>Join the scan data with enrolled patients, save the file as scan_3, replace the the null value using mean, and load this file for next step</p>\n</div>"}]},"apps":[],"jobName":"paragraph_1512927134155_777429465","id":"20171210-093214_526276840","dateCreated":"2017-12-10T09:32:14-0800","dateStarted":"2017-12-10T10:41:29-0800","dateFinished":"2017-12-10T10:41:29-0800","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:5513"},{"text":"%sql\nselect patient_no, Caudate, Putamen, Striatum, Density, Asymmetry from enrolled_patients left join scan_2 on patient_no=PATNO","user":"anonymous","dateUpdated":"2017-12-10T09:46:08-0800","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"sql","editOnDblClick":false},"editorMode":"ace/mode/sql","tableHide":false},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1510033631257_-1441139883","id":"20171106-214711_104366722","dateCreated":"2017-11-06T21:47:11-0800","dateStarted":"2017-12-10T09:46:08-0800","dateFinished":"2017-12-10T09:46:48-0800","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:5514"},{"text":"val scan_3 = sc.textFile(\"/bhd-project-team27/data/scan_3.csv\")\n    .map(line => line.split(\",\"))\n    .filter(line => !line(0).contains(\"patient_no\"))\n    .map(line => Datscan(line(0), line(1).toDouble, line(2).toDouble, line(3).toDouble, line(4).toDouble, line(5).toDouble))\nscan_3.toDF(\"patient_no\", \"Caudate\", \"Putamen\", \"Striatum\", \"Density\", \"Asymmetry\").registerTempTable(\"scan_3\")\n","user":"anonymous","dateUpdated":"2017-12-10T10:47:27-0800","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala"},"editorMode":"ace/mode/scala","tableHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"scan_3: org.apache.spark.rdd.RDD[Datscan] = MapPartitionsRDD[3524] at map at <console>:44\nwarning: there was one deprecation warning; re-run with -deprecation for details\n"}]},"apps":[],"jobName":"paragraph_1510033913309_-714735604","id":"20171106-215153_1623271739","dateCreated":"2017-11-06T21:51:53-0800","dateStarted":"2017-12-10T10:25:19-0800","dateFinished":"2017-12-10T10:25:20-0800","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:5515"},{"text":"%md\nmerge DATscan and MRI, and replace the null in MRIRSLT using its mean, and save the file as MRI and DatScan.csv","user":"anonymous","dateUpdated":"2017-12-10T10:41:32-0800","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"markdown","editOnDblClick":true},"editorMode":"ace/mode/markdown","editorHide":true,"tableHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<div class=\"markdown-body\">\n<p>merge DATscan and MRI, and replace the null in MRIRSLT using its mean, and save the file as MRI and DatScan.csv</p>\n</div>"}]},"apps":[],"jobName":"paragraph_1512927233126_-52135136","id":"20171210-093353_1957266031","dateCreated":"2017-12-10T09:33:53-0800","dateStarted":"2017-12-10T10:41:32-0800","dateFinished":"2017-12-10T10:41:32-0800","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:5516"},{"text":"%sql\nselect patient_no, MRIRSLT, Caudate, Putamen, Striatum, Density, Asymmetry from incomplete_MRI right join scan_3 on patient_no=PATNO","user":"anonymous","dateUpdated":"2017-12-10T10:32:35-0800","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"sql"},"editorMode":"ace/mode/sql","tableHide":false},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1510035291784_1174371105","id":"20171106-221451_803760822","dateCreated":"2017-11-06T22:14:51-0800","dateStarted":"2017-12-10T10:32:35-0800","dateFinished":"2017-12-10T10:32:35-0800","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:5517"},{"text":"%sql\n","user":"anonymous","dateUpdated":"2017-12-10T08:12:42-0800","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"sql"},"editorMode":"ace/mode/sql","tableHide":false},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1510035329826_1131926132","id":"20171106-221529_632788814","dateCreated":"2017-11-06T22:15:29-0800","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:5518"}],"name":"Imaging_feature_construction","id":"2CX6J28YX","angularObjects":{"2CXEBNHHU:shared_process":[],"2CZ9PCYDQ:shared_process":[],"2CYR2ANEV:shared_process":[],"2CZKT2Y9Q:shared_process":[],"2CYMT6N5X:shared_process":[],"2CXU1MDSH:shared_process":[],"2CWJ6EE64:shared_process":[],"2CYH5PHRK:shared_process":[],"2CX5DS48A:shared_process":[],"2CXN7Z1RK:shared_process":[],"2CWHR8QJ9:shared_process":[],"2CZ2P7HTM:shared_process":[],"2CWS93FW1:shared_process":[],"2CY2ZNYVM:shared_process":[],"2CWK65AQY:shared_process":[],"2CZF8FNHR:shared_process":[],"2CXKWH9YA:shared_process":[],"2CY6SY8MJ:shared_process":[],"2CX51G44W:shared_process":[]},"config":{"looknfeel":"default","personalizedMode":"false"},"info":{}}